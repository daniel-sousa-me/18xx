version: '3.5'

x-rack: &rack
  image: 18xx_rack:dev
  environment:
    DATABASE_URL: postgres://root:password@db:5432/18xx_development
    RACK_ENV: development
    RUBYOPTS: --jit
  build:
    args:
      RACK_ENV: development
  volumes:
    - .:/18xx:z
    - /18xx/vendor
    deploy:
      resources:
        limits:
          cpus: '0.2'

services:
  rack:
    image: 18xx_rack:dev
    environment:
      RACK_ENV: development
    volumes:
      - .:/18xx
      - /18xx/vendor
    deploy:
      resources:
        limits:
          cpus: '0.2'
